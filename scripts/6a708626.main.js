window.Mi={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";Mi.router=new Mi.Routers.App,Backbone.history.start()}},$(document).ready(function(){"use strict";Mi.init()}),this.JST=this.JST||{},this.JST["app/scripts/templates/about.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="container">\n  <div class="text-container col-sm-10 col-sm-offset-1">\n    <h2>About the World Map of Microinsurance</h2>\n    <p>Based on the last 3 latest regional landscapes (LAC - 2014; Asia – 2013 and Africa – 2012), total self-reported coverage of microinsurance in three major microinsurance regions of Africa, Asia and Latin America stands at 263.4 Million lives and properties which (based on self-reported data) generated microinsurance premiums worth USD 2.1 billion.</p>\n    <p>Regional break ups:</p>\n    <table class="table table-bordered">\n      <thead>\n        <tr>\n          <th><strong>Regional landscape</strong>(for details refer to full reports of the studies)</th>\n          <th><strong>Total lives and properties covered</strong>(in mn)</th>\n          <th><strong>Total microinsurance premium</strong>(in mn USD)</th>\n          <th><strong>% of total population covered</strong></th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr><td>LAC – 2014</td><td>48.6</td><td>830</td><td>7.9</td></tr>\n        <tr><td>Asia - 2013</td><td>170.4</td><td>829</td><td>4.3</td></tr>\n        <tr><td>Africa – 2012</td><td>44.4</td><td>475</td><td>4.4</td></tr>\n      </tbody>\n    </table>\n    <h4><strong>What is the World Map of Microinsurance?</strong></h4>\n    <p>The World Map of Microinsurance (WMM) will be a platform for knowledge generation and sharing on the topic of microinsurance. It will <strong>host data</strong> and analysis from significant <strong>landscape studies</strong>, which will be displayed visually on an interactive world map. This map will serve as the centre of the platform, and will help the user explore data in a way that is informative without being overwhelming. The map will incorporate interactive data tools, such as customizable graphs and tables to compare data. Periodic posts on relevant issues and best/innovative practices in microinsurance will be released on this platform.  The site will also contain country and region profiles, as well as open discussion forums. The World Map of Microinsurance is scheduled to <strong>launch on September 25, 2015.</strong></p>\n    <h4><strong>The history of Landscape studies</strong></h4>\n    <p>The pursuit for understanding the microinsurance sector through the lens of data started with the Landmark study, <a href="http://www.microinsurancecentre.org/resources/documents/unknown/the-landscape-of-microinsurance-in-the-worlds-100-poorest-countries-in-english.html" target="_blank">"The Landscape of Microinsurance in the World’s 100 Poorest Countries"</a>, published in 2006. These were followed by:</p>\n    <ul>\n      <li><strong>Africa 2010</strong> (<a href="http://www.microinsurancenetwork.org//sites/default/files/files/mpaper4_landscape_en.pdf" target="_blank">pdf</a>)</li>\n      <li><strong>Latin America and the Caribbean 2011</strong> (<a href="http://www.microinsurancenetwork.org/groups/landscape-microinsurance-latin-america-and-caribbean-0" target="_blank">web</a>)</li>\n      <li><strong>Africa 2012</strong> (<a href="http://www.microinsurancenetwork.org/groups/landscape-microinsurance-africa-2012" target="_blank">web</a>)</li>\n      <li><strong>Asia and Oceania 2013</strong> (pdf) (<a href="http://www.microinsurancenetwork.org/groups/landscape-microinsurance-asia-and-oceania-2013" target="_blank">web</a>)</li>\n      <li><strong>Latin America and the Caribbean 2014</strong> - to come. Find the <strong>Preliminary Briefing Note</strong> <a href="http://www.microinsurancenetwork.org/groups/landscape-microinsurance-latin-america-and-caribbean-2014-preliminary-briefing-note" target="_blank">here</a></li>\n    </ul>\n    <p>These studies provide an overview of the microinsurance market in Asia, Africa, Latin America and the Caribbean.</p>\n    <p>These landscape studies have been led by the <a href="http://www.munichre-foundation.org" target="_blank">Munich Re Foundation </a> in collaboration with and support from organisations like the ILO’s <a href="http://www.microinsurancefacility.org/" target="_blank">Impact Insurance Facility</a>, the <a href="http://www.iadb.org/en/inter-american-development-bank,2837.html" target="_blank">Inter-American Development Bank</a>, the <a href="http://www.afdb.org" target="_blank">African Development Bank</a>, the <a href="http://www.adb.org" target="_blank">Asian Development Bank</a>, and <a href="http://www.mfw4a.org" target="_blank">Making Finance Work for Africa </a> (MFW4A), <a href="http://www.giz.de/en" target="_blank">GIZ</a> on behalf of <a href="http://www.bmz.de/" target="_blank">BMZ</a>, and the Microinsurance Network. This pioneering research has been carried out by the <a href="http://www.microinsurancecentre.org" target="_blank">MicroInsurance Centre</a> (Landscape study of 100 poorest countries, 2006, Latin America, 2011 and Africa, 2012) and <a href="http://www.microsave.net/" target="_blank">MicroSave</a> (Asia, 2013).</p>\n    <p>To ensure a long-term follow up and continued access to microinsurance data, the Microinsurance Network will institutionalise and expand upon these previous efforts by ensuring the further development of the World Map of Microinsurance (WMM) programme.</p>\n    <h4><strong>Why do we need it?</strong></h4>\n    <p>Insurance is a data-driven industry, and the World Map of Microinsurance will enable the sector to develop effectively, producing more valuable products for clients while improving profitability for insurers.  As microinsurance is an emerging industry, there is not sufficient data to create field-wide benchmarks on which to assess performance. <br>Data is critical</strong> to the advancement of microinsurance, as it generates market knowledge, facilitates market development, furthers best practices and can lead to better products and services. On a global level, data can identify factors that detract from or drive development. Country-level data is essential to effective pricing, insurers’ ability to understand the low-income market, and the development of quantitative goals and benchmarks. On a company-level basis, improving insurers’ knowledge of the low-income market is mutually beneficial for both the insurer and the client: Clients gain access to products which better meet their needs, and insurers can expand their client base.</p>\n    <h4><strong>What will it achieve?</strong></h4>\n    <p>Ultimately, we want the WMM to advance microinsurance as a tool that can effectively protect low income populations in developing countries against the crises that push them into and trap them in poverty.</p>\n    <p>This can be achieved, first and foremost, <strong>by providing insurers with the knowledge they need</strong> to create more valuable and effective products. By gaining a better understanding of the low income market and the specific needs of the clients they serve, firms can design products which meet the needs of their client-base at a price that is efficient. The tractability of the data will allow firms to gain important information about the market they work in, and subsequently will empower them to grow their business, reaching even more low-income clients.</p>\n    <p>The platform will be the destination for data and research on microinsurance. Having data on microinsurance converge in one location creates a space for further knowledge generation, collaboration, and learning.  Creating a collective authority on microinsurance will help gain respect and recognition for the industry, and will advance its status as an important tool for development worldwide.</p>\n  </div>\n</div><!-- /.navbar-collapse -->\n';return __p},this.JST["app/scripts/templates/countries.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="aggregate-bar">\n  <h2 class="aggregate-title">'+(null==(__t=region)?"":__t)+" Summary</h2>\n</div>\n",_.each(aggregate.graphs,function(a,b){__p+="\n  ",""!==a.mainValue&&(__p+='\n  <div class="col-sm-3 col-md-3 col-xs-6 row-type">\n	  <div class="inner">\n		  <a class="more-info" href="#" data-toggle="popover" title="'+(null==(__t=a.name)?"":__t)+'" data-content="'+(null==(__t=Mi.description[a.type])?"":__t)+'">?</a>\n			  <span class="mi-ratio-value"><a>'+(null==(__t=a.mainValue.toFixed(2))?"":__t)+'%</a></span>\n				<span class="mi-ratio-label">'+(null==(__t=a.name)?"":__t)+'</span>\n				<div id="chart-'+(null==(__t=a.type.slice(0,15))?"":__t)+'" class="hchart"></div>\n				<span class="mi-crude-value">'+(null==(__t=numberWithCommas(a.crudeCoverage))?"":__t)+' lives insured</span>\n				<span class="mi-year-value">Year: '+(null==(__t=a.year)?"":__t)+"</span>\n			</div>\n		</div>\n  "),__p+="\n"}),__p+='\n<div class="aggregate-bar added-top">\n  <h2 class="aggregate-title">Countries</h2>\n</div>\n',data.filter(function(a){return""!==a.mainValue}).length?(__p+="\n  ",_.each(data,function(a){__p+="\n    ",""!==a.mainValue&&(__p+='\n      <div class="col-sm-4 col-md-3 col-xs-6 row-country" data-mi-ratio="'+(null==(__t=a.mainValue)?"":__t)+'">\n        <div class="inner">\n          <a class="more-info" data-toggle="popover" data-content="'+(null==(__t=Mi.description[type])?"":__t)+'">?</a>\n          <b>'+(null==(__t=a.country)?"":__t)+'</b>\n          <br>\n          <span class="mi-ratio-value"><a href="#country/'+(null==(__t=a.iso)?"":__t)+'">'+(null==(__t=a.mainValue.toFixed(2))?"":__t)+'%</a></span>\n          <span class="mi-ratio-label">'+(null==(__t=a.name)?"":__t)+'</span>\n          <div id="'+(null==(__t=a.iso)?"":__t)+'-chart" class="hchart"></div>\n          <span class="mi-crude-value">'+(null==(__t=numberWithCommas(a.crudeCoverage))?"":__t)+' lives insured</span>\n          <span class="mi-year-value">Year: '+(null==(__t=a.filterYear)?"":__t)+"</span>\n        </div>\n      </div>\n    "),__p+="\n  "}),__p+="\n"):__p+='\n  <div class="aggregate-bar">\n    <h4 class="aggregate-title">Life insurance data reported for Asia 2013 is all inclusive of credit and non-credit life coverages; No data is shown for the subcategories.</h4>\n  </div>\n',__p+="\n";return __p},this.JST["app/scripts/templates/country.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="aggregate-bar">\n  <h2 class="aggregate-title">'+(null==(__t=data[0].country)?"":__t)+"</h2>\n  ",extraLink&&(__p+='\n    <div class="aggregate-stat">\n      <div class="aggregate-stat-title">\n        <span>More Info</span>\n      </div>\n      <div class="aggregate-stat-info">\n        <span><a href="'+(null==(__t=extraLink)?"":__t)+'" target="_blank">'+(null==(__t=data[0].country)?"":__t)+"</a></span>\n      </div>\n    </div>\n  "),__p+="\n  ",_.each(countryStats,function(a){__p+="\n  ",a.info.value&&(__p+='\n    <div class="aggregate-stat">\n      <div class="aggregate-stat-title">\n        <span>'+(null==(__t=a.name)?"":__t)+'</span>\n        <span class="year">('+(null==(__t=a.info.year)?"":__t)+')</span>\n      </div>\n      <div class="aggregate-stat-info">\n        <span>'+(null==(__t=numberWithCommas(Math.round(a.info.value)))?"":__t)+(null==(__t=a.suffix)?"":__t)+"</span>\n      </div>\n    </div>\n  "),__p+="\n  "}),__p+="\n</div>\n",_.each(data,function(a,b){__p+="\n  ",a.name.indexOf("ratio")>=0&&""!==a.indicatorValue&&(__p+='\n	  <div class="col-sm-4 col-md-3 col-xs-6 row-country '+(null==(__t=a.varName)?"":__t)+'">\n		  <div class="inner">\n			  <a class="more-info" href="#" data-toggle="popover" title="'+(null==(__t=a.name)?"":__t)+'" data-content="'+(null==(__t=Mi.description[a.varName])?"":__t)+'">?</a>\n				  <span class="mi-ratio-value"><a>'+(null==(__t=a.indicatorValue.toFixed(2))?"":__t)+'%</a></span>\n					<span class="mi-ratio-label">'+(null==(__t=a.name)?"":__t)+'</span>\n					<div id="'+(null==(__t=a.iso)?"":__t)+"-chart-"+(null==(__t=b)?"":__t)+'" class="hchart"></div>\n					<span class="mi-crude-value">'+(null==(__t=numberWithCommas(a.crudeCoverage))?"":__t)+' lives insured</span>\n					<span class="mi-year-value">Year: '+(null==(__t=a.indicatorYear)?"":__t)+"</span>\n				</div>\n			</div>\n  "),__p+="\n"}),__p+="\n";return __p},this.JST["app/scripts/templates/global.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)_.each(regions,function(a,b){__p+="\n  ",a.mainValue>0&&(__p+='\n    <div class="col-sm-4 col-md-4 col-xs-6 row-country" data-mi-ratio="'+(null==(__t=a.mainValue)?"":__t)+'">\n      <div class="inner">\n        <a class="more-info" data-toggle="popover" data-content="'+(null==(__t=Mi.description[type])?"":__t)+'">?</a>\n        <b>'+(null==(__t=Mi.regions[b])?"":__t)+'</b>\n        <br>\n        <span class="mi-ratio-value"><a href="" class="region-nav" id="'+(null==(__t=b)?"":__t)+'">'+(null==(__t=a.mainValue)?"":__t)+'%</a></span>\n        <span class="mi-ratio-label">'+(null==(__t=name)?"":__t)+'</span>\n        <div id="'+(null==(__t=b)?"":__t)+'-chart" class="hchart"></div>\n        <span class="mi-crude-value">'+(null==(__t=numberWithCommas(a.crudeCoverage))?"":__t)+' lives insured</span>\n        <span class="mi-year-value">Year: '+(null==(__t=a.year)?"":__t)+"</span>\n      </div>\n    </div>\n  "),__p+="\n"}),__p+="\n";return __p},this.JST["app/scripts/templates/header.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="container">\n  <!-- Brand and toggle get grouped for better mobile display -->\n  <div class="navbar-header">\n    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">\n    <span class="sr-only">Toggle navigation</span>\n    <span class="icon-bar"></span>\n    <span class="icon-bar"></span>\n    <span class="icon-bar"></span>\n    </button>\n    <a class="navbar-brand mi-reset" href="#">World Map of Microinsurance</a>\n  </div>\n\n  <!-- Collect the nav links, forms, and other content for toggling -->\n  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">\n    <ul class="nav navbar-nav">\n      <li><a href="#about">About</a></li>\n      <li><a href="#partners">Partners</a></li>\n      <li><a href="http://www.microinsurancenetwork.org/community/blog/insights-and-perspectives?tag=799">Blog</a></li>\n    </ul>\n    <ul class="nav navbar-nav navbar-right">\n      <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Study <span class="caret"></span></a>\n        <ul class="dropdown-menu menu-study" role="menu">\n          ',_.each(studies,function(a){__p+='\n            <li><a class="mi-filter" data-var="'+(null==(__t=a.region_code)?"":__t)+" "+(null==(__t=a.data_year)?"":__t)+'" target="_blank">'+(null==(__t=a.name)?"":__t)+"</a></li>\n          "}),__p+='\n        </ul>\n      </li>\n      <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Region <span class="caret"></span></a>\n        <ul class="dropdown-menu menu-region" role="menu">\n          <li><a class="mi-filter" data-var="global" href="#">Global</a></li>\n          <li class="divider"></li>\n          ',_.each(regions,function(a,b){__p+='\n            <li><a class="mi-filter" data-var="'+(null==(__t=b)?"":__t)+'" target="_blank">'+(null==(__t=a)?"":__t)+"</a></li>\n          "}),__p+='\n        </ul>\n      </li>\n      <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Type <span class="caret"></span></a>\n        <ul class="dropdown-menu menu-type" role="menu">\n          <li><a class="mi-filter" data-var="total-microinsurance-coverage-ratio" href="#">Total microinsurance coverage ratio</a></li>\n          <li class="divider"></li>\n          <li><a class="mi-filter" data-var="health-coverage-ratio" href="#">Health coverage ratio</a></li>\n          <li><a class="mi-filter" data-var="accident-coverage-ratio" href="#">Accident coverage ratio</a></li>\n          <li><a class="mi-filter" data-var="property-coverage-ratio" href="#">Property coverage ratio</a></li>\n          <li><a class="mi-filter" data-var="agriculture-coverage-ratio" href="#">Agriculture coverage ratio</a></li>\n          <li><a class="mi-filter" data-var="credit-life-coverage-ratio" href="#">Credit life coverage Ratio</a></li>\n          <li><a class="mi-filter" data-var="life-coverage-ratio-(excluding-credit-life)" href="#">Life coverage ratio (excluding credit life)</a></li>\n          <li><a class="mi-filter" data-var="life-and-accident-coverage-ratio-(excluding-credit-life)" href="#">Life and accident coverage ratio (excluding credit life)</a></li>\n        </ul>\n      </li>\n      <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Share <span class="caret"></span></a>\n        <ul class="dropdown-menu menu-share" role="menu">\n          <li><a id="twitter-share-btn" href="#">Twitter</a></li>\n          <li><a id="facebook-share-btn" href="#">Facebook</a></li>\n          <li><a id="linkedin-share-btn" href="#">LinkedIn</a></li>\n        </ul>\n      </li>\n      <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Data <span class="caret"></span></a>\n        <ul class="dropdown-menu menu-data" role="menu">\n          <li><a href="assets/data/mi-data.csv">Download (csv)</a></li>\n          <li role="presentation" class="divider"></li>\n          <li role="presentation" class="dropdown-header">Landscape Studies (pdf)</li>\n          ',_.each(studies.filter(function(a){return a.link}),function(a){__p+='\n            <li><a href="'+(null==(__t=a.link)?"":__t)+'" target="_blank">'+(null==(__t=a.name)?"":__t)+"</a></li>\n          "}),__p+="\n        </ul>\n      </li>\n    </ul>\n  </div>\n</div><!-- /.navbar-collapse -->\n";return __p},this.JST["app/scripts/templates/partners.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="container">\n  <div class="text-container col-sm-10 col-sm-offset-1">\n    <h2>Partners of the WMM</h2>\n    <p><a href="http://www.luxembourg.public.lu/en/" target="_blank"><img src="images/luxgov.jpg" style="height:94px"/></a></p>\n    <p><a href="http://www.munichre-foundation.org/home.html" target="_blank"><img src="images/munichre-big.jpg" style="height:91px"/></a></p>\n    <p><a href="http://www.microinsurancecentre.org/" target="_blank"><img src="images/mic-big.jpg" style="height:66px"/></a></p>\n    <br>\n    <h3>Regional sponsors for the Landscape study of Latin America and the Caribbean 2014</h3>\n    <br>\n    <p><a href="http://www.bradescoseguros.com.br/" target="_blank"><img src="images/bradesco-seguros.jpg" style="height:59px"/></a></p>\n    <p><a href="http://www.cnseg.org.br/cnseg/home.html" target="_blank"><img src="images/cnseg-compactado.jpg" style="height:90px"/></a></p>\n    <p><a href="http://www.iadb.org/en/inter-american-development-bank,2837.html" target="_blank"><img src="images/iadb.jpg" style="height:66px"/></a></p>\n    <p><a href="http://www.iadb.org/en/resources-for-businesses/multilateral-investment-fund,5763.html" target="_blank"><img src="images/mif-idb.jpg" style="height:102px" /></a></p>\n  	<p><a href="http://www.worldbank.org/" target="_blank"><img src="images/wbg.jpg" style="height:68px"/></a></p>\n  </div>\n</div><!-- /.navbar-collapse -->\n';return __p},Mi.Routers=Mi.Routers||{},function(){"use strict";var a=!1;$(document).on("click",".mi-reset",function(a){Mi.year="all",Mi.region="global",Mi.name="total-microinsurance-coverage-ratio"}),Mi.dataFolder="assets/data/",Mi.dataUrl=Mi.dataFolder+"mi-data.csv",Mi.studyUrl=Mi.dataFolder+"studies.csv",Mi.typeUrl=Mi.dataFolder+"types.csv",Mi.linkUrl=Mi.dataFolder+"links.csv",Mi.year="all",Mi.region="global",Mi.name="total-microinsurance-coverage-ratio",Mi.token="pk.eyJ1IjoiZGV2c2VlZCIsImEiOiJnUi1mbkVvIn0.018aLhX0Mb0tdtaT2QNe2Q",Mi.labelControl=L.Control.extend({options:{position:"bottomleft"},initialize:function(a){L.setOptions(this,a),this._info={}},onAdd:function(a){return this._container=L.DomUtil.create("div","leaflet-control-layers leaflet-control"),this._content=L.DomUtil.create("div","leaflet-control-layers-toggle",this._container),L.DomEvent.disableClickPropagation(this._container),this._container}}),Mi.resetControl=L.Control.extend({options:{position:"topleft"},initialize:function(a){L.setOptions(this,a),this._info={}},onAdd:function(a){return this._container=L.DomUtil.create("div","leaflet-control"),this._content=L.DomUtil.create("div","leaflet-control-reset",this._container),this._container}}),Mi.Routers.App=Backbone.Router.extend({initialize:function(){this.headerInit()},routes:{"":"viewPage","view/:region/:year/:name":"viewPage","country/:country":"viewCountry",about:"about",partners:"partners"},execute:function(a,b){$("#content").empty().hide().fadeIn(),$(".loader").fadeIn(),Mi.data?($(".page-header").css("display","block"),$("#map").css("display","block"),$("#content").removeClass("about"),$("#content").removeClass("partners"),a&&a.apply(this,b)):this.loadData(a,b)},loadData:function(a,b){var c=this;d3.csv(Mi.dataUrl,function(a){return{category:a.Category,name:a.Indicator,timeseries:_.map(_.filter(_.keys(a),function(a){return!isNaN(Number(a))}),function(b){return{year:Number(b),value:""===a[b]?"":Number(a[b])}}),varName:a.Indicator.split(" ").join("-").toLowerCase(),country:a.Country,region:a.Region.toLowerCase(),iso:a.iso3}},function(d,e){Mi.data=e,Mi.countryGrouped=_.groupBy(Mi.data,"country"),Mi.varNameGrouped=_.groupBy(Mi.data,"varName"),Mi.doubledGrouped={},_.each(Mi.countryGrouped,function(a,b){Mi.doubledGrouped[b]=_.groupBy(a,"varName")}),Mi.years=_.pluck(Mi.data[0].timeseries,"year"),Mi.nameObject=_.zipObject(_.unique(_.pluck(Mi.data,"varName")),_.unique(_.pluck(Mi.data,"name"))),c.mapInit(function(){a&&a.apply(c,b)})})},viewPage:function(b,c,d){var e=this;if(this.closePopups(),b&&(Mi.region=b),c&&(Mi.year=c),d&&(Mi.name=d),"global"===Mi.region){new Mi.Views.Global({year:Mi.year,type:Mi.name,data:Mi.varNameGrouped[Mi.name],graphData:{population:Mi.varNameGrouped["population-(total)"],crudeCoverage:Mi.varNameGrouped[Mi.name.replace("-ratio","")]}})}else{var f=Mi.data.filter(function(a){return e.regionMatch(a.region,Mi.region)}),g=Mi.varNameGrouped[Mi.name].filter(function(a){return e.regionMatch(a.region,Mi.region)});new Mi.Views.Countries({year:Mi.year,type:Mi.name,region:Mi.region,data:g,extraData:f})}a=!0,$(".loader").fadeOut()},viewCountry:function(b){var c=this;a||this.viewPage(),this.closePopups();var d=[];_.each(Mi.data,function(a){b===a.iso&&"Microinsurance"===a.category&&d.push(a)});var e={};_.each(Mi.data,function(a){b===a.iso&&_.contains(["Population (Total)","GDP (current US$)","Microinsurance Gross Premium (USD)","Total microinsurance coverage","Total microinsurance coverage ratio"],a.name)&&(e[a.varName]={value:c.getFromTimeseries(a.timeseries,"all"),year:c.getFromTimeseries(a.timeseries,"all","year")})});new Mi.Views.Country({year:Mi.year,type:Mi.name,region:Mi.region,data:d,iso:d[0].iso,country:d[0].country,extraData:e});$(".loader").fadeOut()},about:function(){new Mi.Views.About,$(".loader").fadeOut()},partners:function(){new Mi.Views.Partners,$(".loader").fadeOut()},mapInit:function(a){var b=this;L.mapbox.accessToken=Mi.token,Mi.map=L.map("map",{maxBounds:[[-60,-180],[90,180]],noWrap:!0}).setView([20,0],2),Mi.map.scrollWheelZoom.disable(),d3.json(Mi.dataFolder+"geo/ne_50m.topojson",function(c,d){d3.json(Mi.dataFolder+"geo/disputed.topojson",function(c,e){Mi.countryGeo=L.geoJson(topojson.feature(d,d.objects.ne_50m),{style:function(a){return{color:"white",weight:1,fillColor:"url(#hash)",fillOpacity:1,className:"no-data"}}}),Mi.disputedGeo=L.geoJson(topojson.feature(e,e.objects.disputed),{style:function(a){return{dashArray:"6,3",fill:!1,color:"#fff",opacity:.8,weight:.5}}}),Mi.choroLayer=L.featureGroup(),Mi.countryGeo.addTo(Mi.choroLayer),Mi.choroLayer.addTo(Mi.map),Mi.disputedGeo.addTo(Mi.map),b.mapNoData(),a()})}),Mi.labels=L.mapbox.tileLayer("wmm2016.8a3ec4fa",{noWrap:!0});var c=new Mi.resetControl;c.addTo(Mi.map),$(".leaflet-control-reset").on("click",function(){Mi.region="global",b.navigate("/view/"+Mi.region+"/"+Mi.year+"/"+Mi.name,{trigger:!0})});var d=new Mi.labelControl;d.addTo(Mi.map),$(".leaflet-control-layers").on("click",function(){Mi.map.hasLayer(Mi.labels)?Mi.map.removeLayer(Mi.labels):Mi.map.addLayer(Mi.labels)})},mapNoData:function(){var a=d3.select("#map svg").insert("defs",":first-child"),b=4,c=a.append("pattern").attr("id","hash").attr("patternUnits","userSpaceOnUse").attr("width",b).attr("height",b).attr("x",0).attr("y",0).append("g").style("fill","none").style("stroke","#ddd").style("stroke-width",.5);c.append("path").attr("d","M"+b+",0 l-"+b+","+b)},headerInit:function(){d3.csv(Mi.linkUrl,function(a,b){Mi.links={},_.each(b,function(a){Mi.links[a.countryCode]=a.link}),d3.csv(Mi.typeUrl,function(a,b){var c={};_.each(b,function(a){c[a.type]=a.description}),Mi.description=c,d3.csv(Mi.studyUrl,function(a,b){var c={};_.each(b,function(a){a.region_name&&(c[a.region_code]=a.region_name)}),Mi.regions=c,Mi.header=new Mi.Views.Header({studies:b,regions:c})})})})},closePopups:function(){Mi.countryGeo&&Mi.countryGeo.eachLayer(function(a){try{a.closePopup()}catch(b){_.each(a._layers,function(a){a.closePopup()})}})},regionMatch:function(a,b){switch(b){case"africa":return"africa"===a;case"americas":return"americas"===a;case"asia":return _.contains(["asia","oceania"],a)}},getFromTimeseries:function(a,b,c,d){var e=c||"value";if("all"===b){var f=this.lastNonEmptyIndex(_.pluck(a,"value"),d);return f>0?a[f][e]:""}var g="";return _.each(a,function(a){parseFloat(b)===parseFloat(a.year)&&(g=a[e])}),g},aggregateTimeseries:function(a){return a.reduce(function(a,b){return _.merge(_.cloneDeep(a),b,function(a,b){return{year:a.year,value:Number(a.value)+Number(b.value)}})})},yearToIndex:function(a){return Mi.years.indexOf(a)},lastNonEmptyElement:function(a,b){var c=this.lastNonEmptyIndex(a,b);return c>0?a[c]:""},lastNonEmptyIndex:function(a,b){for(var c=a.slice(0).reverse(),d=0;d<c.length;d++)if(""!==c[d]&&void 0!==c[d]&&(!b||0!==c[d]))return c.length-d-1;return-1}})}(),Mi.Models=Mi.Models||{},function(){"use strict";Mi.Models.Country=Backbone.Model.extend({urlRoot:"assets/data",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a}})}(),Mi.Collections=Mi.Collections||{},function(){"use strict";Mi.Collections.Countries=Backbone.Collection.extend({model:Mi.Models.Countries})}(),Mi.Views=Mi.Views||{},function(){"use strict";Mi.Views.About=Backbone.View.extend({el:"#content",initialize:function(a){$(".page-header").css("display","none"),$("#map").css("display","none"),$("#content").addClass("about"),this.render()},render:function(){var a=this;$.get("about.html",function(b){a.$el.html(b)})}})}(),Mi.Views=Mi.Views||{},function(){"use strict";Mi.Views.Partners=Backbone.View.extend({el:"#content",initialize:function(a){$(".page-header").css("display","none"),$("#map").css("display","none"),$("#content").addClass("partners"),this.render()},render:function(){var a=this;$.get("partners.html",function(b){a.$el.html(b)})}})}(),Mi.Views=Mi.Views||{},function(){"use strict";var a="#006Da1",b="#3a3",c="maroon",d="#a61",e="#63b",f="#321",g="#0B2F35",h="#092317";Mi.Views.Base=Backbone.View.extend({el:"#content",drawLineChart:function(a,b,c,d,e,f,g){var h=this,i=e||this.type,j=h.getColor(2,i).hex(),k={allowDecimals:!!f,min:0,title:{text:""},labels:{x:-8,enabled:!0,style:{color:"#aaa"}},gridLineColor:"#fff",tickWidth:1,tickLength:5};g&&(k.max=g),$(a).highcharts({chart:{plotBorderColor:"#fff",style:{fontFamily:"'Abel', sans-serif"}},title:{text:"",x:-20},subtitle:{text:"",x:-20},xAxis:{categories:c,labels:{enabled:!0,style:{color:"#aaa"}}},yAxis:k,credits:{enabled:!1},tooltip:{valueSuffix:"%"},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0,enabled:!1},series:[{color:j,name:"Ratio",data:b}]})},numberWithCommas:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},setView:function(a){switch(a){case"africa":Mi.map.setView([4.43,28.83],3);break;case"americas":Mi.map.setView([2.2,-77.26],3);break;case"asia":Mi.map.setView([26.98,87.1],3);break;default:Mi.map.setView([20,0],2)}},drawLegend:function(){var a=this;d3.select(".legend").select("*").remove();var b={top:20,right:10,bottom:10,left:10},c=d3.select(".legend").style("width").replace("px","")-b.left-b.right,d=d3.select(".legend").style("height").replace("px","")-b.top-b.bottom,e=d3.select(".legend").append("svg").attr("width",c+b.left+b.right).attr("height",d+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),f=[0,.1,1,2,3];e.selectAll("color").data(f).enter().append("rect").attr("fill",function(b){return a.getColor(b,a.type)}).attr("opacity",function(a){return a?.8:.4}).attr("width",c/f.length).attr("height",d).attr("y",0).attr("x",function(a,b){return b*c/f.length}),e.selectAll("label").data(f).enter().append("text").attr("class","label").attr("dy",-5).attr("x",function(a,b){return(b+.5)*c/f.length}).attr("text-anchor","middle").text(function(a,b){return 0===a?"0%":Math.floor(f[b])+(f[b+1]?" - "+f[b+1]+"%":"%+")})},typeToColor:function(i){switch(i){case"total-microinsurance-coverage-ratio":return a;case"credit-life-coverage-ratio":return c;case"health-coverage-ratio":return b;case"accident-coverage-ratio":return d;case"property-coverage-ratio":return f;case"agriculture-coverage-ratio":return e;case"life-coverage-ratio-(excluding-credit-life)":return g;case"life-and-accident-coverage-ratio-(excluding-credit-life)":return h}},getColor:function(a,b){var c=["white",this.typeToColor(b)],d=chroma.scale(c).mode("hsl").domain([-1,0,1,2,3,4]);return 0===Number(a)?"#ccc":d(Math.floor(Math.min(a,3)))},resetMapStyle:function(){Mi.countryGeo.eachLayer(function(a){a.setStyle({color:"white",weight:1,fillColor:"url(#hash)",fillOpacity:1}),d3.selectAll(".leaflet-overlay-pane path").classed("no-data",!0)})},regionMatch:function(a,b){switch(b){case"africa":return"africa"===a;case"americas":return"americas"===a;case"asia":return _.contains(["asia","oceania"],a)}},regionNav:function(a){a.preventDefault(),Mi.router.navigate("view/"+a.target.id.toLowerCase()+"/"+Mi.year+"/"+Mi.name,{trigger:!0})},updateShareLinks:function(){$("#twitter-share-btn").attr("href","https://twitter.com/home?status="+window.location.href),$("#facebook-share-btn").attr("href","https://www.facebook.com/sharer/sharer.php?u="+window.location.href),$("#linkedin-share-btn").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+window.location.href)},updateMap:function(a){var b=this;Mi.countryGeo.eachLayer(function(c){if(a.iso===c.feature.properties.iso_a3&&""!==a.mainValue){var d=b.getColor(a.mainValue,b.type);c.setStyle({fillColor:d,fillOpacity:a.mainValue?.8:.3}),c._path?c._path.setAttribute("class","leaflet-clickable"):_.each(c._layers,function(a){a._path.setAttribute("class","leaflet-clickable")});var e='<div class="inner"><span class="country-name">'+a.country+'</span><span class="year"> ('+a.filterYear+')</span><br><span class="popup-value">'+b.capitalizeFirstLetter(b.type.replace(/-/g," "))+": "+a.mainValue+'%</span><br><a href="#country/'+a.iso+'">View profile</a></div>';c.bindPopup(e,{autoPan:!0})}})},getFromTimeseries:function(a,b,c,d){var e=c||"value";if("all"===b){var f=this.lastNonEmptyIndex(_.pluck(a,"value"),d);
return f>0?a[f][e]:""}var g="";return _.each(a,function(a){parseFloat(b)===parseFloat(a.year)&&(g=a[e])}),g},aggregateTimeseries:function(a){return a.reduce(function(a,b){return _.merge(_.cloneDeep(a),b,function(a,b){return{year:a.year,value:Number(a.value)+Number(b.value)}})})},yearToIndex:function(a){return Mi.years.indexOf(a)},lastNonEmptyElement:function(a,b){var c=this.lastNonEmptyIndex(a,b);return c>0?a[c]:""},lastNonEmptyIndex:function(a,b){for(var c=a.slice(0).reverse(),d=0;d<c.length;d++)if(""!==c[d]&&void 0!==c[d]&&(!b||0!==c[d]))return c.length-d-1;return-1}})}(),Mi.Views=Mi.Views||{},function(){"use strict";Mi.Views.Header=Backbone.View.extend({template:JST["app/scripts/templates/header.ejs"],el:"#main-header",initialize:function(a){this.studies=a.studies,this.regions=a.regions,this.render()},events:{'click .dropdown-menu:not(".menu-data")':"dropdownNav"},render:function(){this.$el.html(this.template({studies:this.studies,regions:this.regions}))},dropdownNav:function(a){switch(a.preventDefault(),a.currentTarget.classList[1]){case"menu-type":Mi.name=$(a.target).attr("data-var");break;case"menu-region":Mi.region=$(a.target).attr("data-var"),Mi.year="all";break;case"menu-study":var b=$(a.target).attr("data-var").split(" ");Mi.region=b[0],Mi.year=b[1]}Mi.router.navigate("view/"+Mi.region+"/"+Mi.year+"/"+Mi.name,{trigger:!0})}})}(),Mi.Views=Mi.Views||{},function(){"use strict";Mi.Views.Country=Mi.Views.Base.extend({template:JST["app/scripts/templates/country.ejs"],initialize:function(a){this.year=a.year,this.type=a.type,this.region=a.region,this.data=a.data,this.iso=a.iso,this.country=a.country,this.extraData=a.extraData,this.render()},render:function(){var a=this;Mi.countryGeo.eachLayer(function(b){b.feature.properties.iso_a3===a.iso&&Mi.map.fitBounds(b.getBounds())}),_.each(this.data,function(b){b.indicatorValue="",b.name.indexOf("ratio")>=0?null!=b.indicatorValue&&(b.indicatorValue=a.getFromTimeseries(b.timeseries,"all"),b.indicatorYear=a.getFromTimeseries(b.timeseries,"all","year"),b.crudeCoverage=a.getFromTimeseries(Mi.doubledGrouped[a.country][b.varName.replace("-ratio","")][0].timeseries,"all")):b.indicatorValue=a.getFromTimeseries(b.timeseries,"all")}),this.data.sort(function(a,b){return b.indicatorValue-a.indicatorValue}),this.$el.html(this.template({data:this.data,numberWithCommas:this.numberWithCommas,type:this.type,countryStats:[{name:"Microinsurance Premiums",info:this.extraData["microinsurance-gross-premium-(usd)"],suffix:"$ (US)"},{name:"GDP per capita",info:{value:this.extraData["gdp-(current-us$)"].value/this.extraData["population-(total)"].value,year:this.extraData["gdp-(current-us$)"].year},suffix:"$ (US)"},{name:"Population",info:this.extraData["population-(total)"]}],extraLink:Mi.links[a.iso]})),_.each(this.data,function(b,c){if(b.name.indexOf("ratio")>=0&&""!==b.indicatorValue){var d=[],e=[];$.each(b.timeseries,function(a,b){""!==b.value&&(d.push(b.value),e.push(b.year))}),a.drawLineChart("#"+b.iso+"-chart-"+c,d,e,b.name,b.varName)}}),$(".more-info").popover({placement:"top",trigger:"hover",viewport:".row-country"})}})}(),Mi.Views=Mi.Views||{},function(){"use strict";Mi.Views.Countries=Mi.Views.Base.extend({template:JST["app/scripts/templates/countries.ejs"],initialize:function(a){this.year=a.year,this.type=a.type,this.region=a.region,this.data=a.data,this.extraData=a.extraData,this.processData(),this.render()},render:function(){var a=this;this.region||(this.region="global");var b="";"asia"===this.region&&this.type.match(/life/i)&&(b='<span class="asterisk" data-content="Life insurance data reported for Asia 2013 is all inclusive of credit and non-credit life coverages; No data is shown for the subcategories.">*</span>'),$(".region-value").text(Mi.regions[this.region]),$(".type-value").html(this.capitalizeFirstLetter(this.type.replace(/-/g," "))+b),"all"===this.year?$(".year-value").text("Most recent value"):$(".year-value").text(this.year),$(".asterisk").popover({placement:"left",trigger:"hover"}),this.setView(this.region),this.drawLegend(),this.$el.html(this.template({data:this.data,numberWithCommas:this.numberWithCommas,type:this.type,region:Mi.regions[this.region],aggregate:this.aggregate})),this.resetMapStyle(),_.each(this.aggregate.graphs,function(b){a.drawLineChart("#chart-"+b.type.slice(0,15),_.pluck(b.chartData,"value"),_.pluck(b.chartData,"year"),b.name,b.type,!0)}),_.each(this.data,function(b){if(a.updateMap(b),""!==b.mainValue){var c=[],d=[];_.each(b.timeseries,function(a){""!==a.value&&(c.push(a.value),d.push(a.year))}),a.drawLineChart("#"+b.iso+"-chart",c,d,b.name)}}),$("#map").animate({height:"450px"}),$(".more-info").popover({placement:"top",trigger:"hover",viewport:".row-country"})},processData:function(){var a=this;_.each(this.data,function(b){b.crudeCoverageType=a.type.replace("-ratio","");var c=Mi.doubledGrouped[b.country][b.crudeCoverageType][0];b.mainValue=a.getFromTimeseries(b.timeseries,a.year),b.crudeCoverage=a.getFromTimeseries(c.timeseries,a.year),b.filterYear=a.getFromTimeseries(b.timeseries,a.year,"year")}),this.data.sort(function(a,b){return b.mainValue-a.mainValue});var b=_.keys(Mi.description),c=_.pluck(a.extraData.filter(function(a){return"population-(total)"===a.varName}),"timeseries"),d=a.aggregateTimeseries(c),e=b.map(function(b){var c=_.pluck(a.extraData.filter(function(a){return a.varName===b.replace("-ratio","")}),"timeseries"),e=a.aggregateTimeseries(c),f=e.map(function(a,b){return d[b].value&&a.value?{year:a.year,value:Number((a.value/d[b].value*100).toFixed(2))}:!1}),g=a.getFromTimeseries(f,a.year),h=a.getFromTimeseries(e,a.year,!1,!0),i=a.getFromTimeseries(f,a.year,"year");return{type:b,chartData:f.filter(function(a){return!!a}),name:Mi.nameObject[b.replace("-ratio","")],mainValue:g,crudeCoverage:h,year:i}});e.sort(function(a,b){return b.mainValue-a.mainValue}),this.aggregate={graphs:e}}})}(),Mi.Views=Mi.Views||{},function(){"use strict";Mi.Views.Global=Mi.Views.Base.extend({template:JST["app/scripts/templates/global.ejs"],initialize:function(a){this.year=a.year,this.type=a.type,this.region="global",this.data=a.data,this.graphData=a.graphData,this.processData(),this.render()},events:{"click .region-nav":"regionNav"},render:function(){var a=this;$(".region-value").text("Global"),$(".type-value").text(this.capitalizeFirstLetter(this.type.replace(/-/g," "))),"all"===this.year?$(".year-value").text("Most recent value"):$(".year-value").text(this.year),this.setView(this.region),this.drawLegend(),this.$el.html(this.template({numberWithCommas:this.numberWithCommas,type:this.type,region:this.region,year:this.year,regions:this.regions,name:this.data[0].name})),this.resetMapStyle(),_.each(this.regions,function(b,c){a.drawLineChart("#"+c+"-chart",_.pluck(b.chartData,"value"),_.pluck(b.chartData,"year"),a.data[0].name,a.type,!0,5*Math.round(a.globalMax/5))}),_.each(this.data,function(b){a.updateMap(b)}),$("#map").animate({height:"450px"}),$(".more-info").popover({placement:"top",trigger:"hover",viewport:".row-country"})},processData:function(){var a=this;_.each(this.data,function(b){b.mainValue=a.getFromTimeseries(b.timeseries,a.year),b.filterYear=a.getFromTimeseries(b.timeseries,a.year,"year")});var b={americas:{},africa:{},asia:{}};_.each(b,function(b,c){var d=_.pluck(a.graphData.population.filter(function(b){return a.regionMatch(b.region,c)}),"timeseries"),e=a.aggregateTimeseries(d);b.sumPopulation=e;var f=_.pluck(a.graphData.crudeCoverage.filter(function(b){return a.regionMatch(b.region,c)}),"timeseries"),g=a.aggregateTimeseries(f),h=g.map(function(a,b){return e[b].value&&a.value?{year:a.year,value:Number((a.value/e[b].value*100).toFixed(2))}:!1}),i=a.getFromTimeseries(h,a.year),j=a.getFromTimeseries(g,a.year,!1,!0),k=a.getFromTimeseries(h,a.year,"year");b.chartData=h.filter(function(a){return!!a}),b.mainValue=i,b.crudeCoverage=j,b.year=k}),this.regions=b,this.globalMax=d3.max(_.flatten(_.map(b,function(a){return _.map(a.chartData,function(a){return a.value})})))}})}();